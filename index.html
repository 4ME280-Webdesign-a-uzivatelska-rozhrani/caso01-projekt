<script>
  const workerURL = "https://aged-lab-b15a.cloudfare-f26.workers.dev";

  const photo = document.getElementById("photo");
  const desc = document.getElementById("desc");
  const refreshBtn = document.getElementById("refreshBtn");
  const uploadForm = document.getElementById("uploadForm");
  const message = document.getElementById("message");

  async function loadRandomPhoto() {
    try {
      message.textContent = "";
      const res = await fetch(workerURL);
      if (!res.ok) throw new Error("Nelze načíst fotku");
      const data = await res.json();
      photo.src = data.url;
      photo.alt = data.description;
      desc.textContent = data.description;
    } catch (e) {
      message.textContent = e.message;
    }
  }

  refreshBtn.addEventListener("click", loadRandomPhoto);
  photo.addEventListener("click", loadRandomPhoto);

  uploadForm.addEventListener("submit", async e => {
    e.preventDefault();
    message.textContent = "";
    const url = uploadForm.url.value.trim();
    const description = uploadForm.description.value.trim();

    if (!url || !description) {
      message.textContent = "Vyplň URL i popis";
      return;
    }

    try {
      const res = await fetch(workerURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url, description }),
      });
      if (!res.ok) throw new Error("Nahrávání selhalo");
      message.style.color = "lightgreen";
      message.textContent = "Fotka přidána!";
      uploadForm.reset();
      loadRandomPhoto();
    } catch (e) {
      message.style.color = "#ffcccb";
      message.textContent = e.message;
    }
  });

  loadRandomPhoto();
</script>
